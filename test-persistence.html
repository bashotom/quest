<!DOCTYPE html>
<html>
<head>
    <title>LocalStorage Test</title>
</head>
<body>
    <h1>LocalStorage Persistence Test</h1>
    <div id="results"></div>
    
    <script type="module">
        import { QuestionnaireLoader } from './services/questionnaire-loader.js';
        import { PersistenceManager } from './services/persistence-manager.js';
        
        async function test() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Test loading config for autonomie
                const data = await QuestionnaireLoader.loadQuestionnaire('autonomie');
                
                resultsDiv.innerHTML = `
                    <h2>Autonomie Configuration Test</h2>
                    <h3>Raw Config JSON:</h3>
                    <pre>${JSON.stringify(data.config, null, 2)}</pre>
                    
                    <h3>Persistence Settings:</h3>
                    <ul>
                        <li><strong>Has persistence config:</strong> ${!!data.config.persistence}</li>
                        <li><strong>Persistence enabled:</strong> ${data.config.persistence?.enabled}</li>
                        <li><strong>Persistence type:</strong> ${data.config.persistence?.type}</li>
                        <li><strong>isPersistenceEnabled() result:</strong> ${PersistenceManager.isPersistenceEnabled(data.config)}</li>
                    </ul>
                    
                    <h3>Test localStorage Operations:</h3>
                `;
                
                // Test localStorage operations
                const testAnswers = { A1: 2, B1: 3, C1: 1 };
                
                console.log('Testing localStorage save...');
                PersistenceManager.saveAnswers('autonomie', testAnswers, data.config);
                
                console.log('Testing localStorage load...');
                const loaded = PersistenceManager.loadAnswers('autonomie', data.config);
                
                resultsDiv.innerHTML += `
                    <ul>
                        <li><strong>Test save:</strong> ${JSON.stringify(testAnswers)}</li>
                        <li><strong>Test load:</strong> ${JSON.stringify(loaded)}</li>
                        <li><strong>Success:</strong> ${JSON.stringify(testAnswers) === JSON.stringify(loaded?.answers)}</li>
                    </ul>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        test();
    </script>
</body>
</html>